<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.4.0 -->
    <script>window.materialVersion = "1.4.0"</script>

    <!-- Title -->
    
    <title>
        
            计算机网络系列 7 - TCP | 
        
        Albert&#39;s Blog
    </title>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    
    
    
    
    
    
    
    
    

    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Albert Humbert">
    <meta name="description" itemprop="description" content="-">
    <meta name="keywords" content="null,notes">

    <!-- Site Verification -->
    
    

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!--iOS -->
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Albert&#39;s Blog">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="https://alberthumbert.github.io">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="计算机网络系列 7 - TCP | Albert&#39;s Blog">
    <meta property="og:image" content="/img/favicon.png" />
    <meta property="og:description" content="-">
    <meta property="og:article:tag" content="notes"> 

    
        <meta property="article:published_time" content="11月 09, 2018" />
        <meta property="article:modified_time" content="3月 14, 2019" />
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:title" content="计算机网络系列 7 - TCP | Albert&#39;s Blog">
    <meta name="twitter:description" content="-">
    <meta name="twitter:image" content="/img/favicon.png">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://alberthumbert.github.io" />

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="https://alberthumbert.github.io/2018/11/09/NetTcp/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Albert&#39;s Blog",
        "logo": "/img/favicon.png"
    },
    "author": {
        "@type": "Person",
        "name": "Albert Humbert",
        "image": {
            "@type": "ImageObject",
            "url": "/img/favicon.png"
        },
        "description": "Paranoid Android"
    },
    "headline": "计算机网络系列 7 - TCP",
    "url": "https://alberthumbert.github.io/2018/11/09/NetTcp/index.html",
    "datePublished": "11月 09, 2018",
    "dateModified": "3月 14, 2019",
    "description": "-",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://alberthumbert.github.io"
    }
}
</script>


    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(key){try{localStorage.removeItem(key)}catch(e){}};lsloader.setLS=function(key,val){try{localStorage.setItem(key,val)}catch(e){}};lsloader.getLS=function(key){var val="";try{val=localStorage.getItem(key)}catch(e){val=""}return val};versionString="/*"+materialVersion+"*/";lsloader.clean=function(){try{var keys=[];for(var i=0;i<localStorage.length;i++){keys.push(localStorage.key(i))}keys.forEach(function(key){var data=lsloader.getLS(key);if(data&&data.indexOf(versionString)===-1){lsloader.removeLS(key)}})}catch(e){}};lsloader.clean();lsloader.load=function(jsname,jspath,cssonload){cssonload=cssonload||function(){};var code;code=this.getLS(jsname);if(code&&code.indexOf(versionString)===-1){this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload);return}if(code){var versionNumber=code.split(versionString)[0];if(versionNumber!=jspath){console.log("reload:"+jspath);this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload);return}code=code.split(versionString)[1];if(/\.js?.+$/.test(versionNumber)){this.jsRunSequence.push({name:jsname,code:code});this.runjs(jspath,jsname,code)}else{document.getElementById(jsname).appendChild(document.createTextNode(code));cssonload()}}else{this.requestResource(jsname,jspath,cssonload)}};lsloader.requestResource=function(name,path,cssonload){var that=this;if(/\.js?.+$/.test(path)){this.iojs(path,name,function(path,name,code){that.setLS(name,path+versionString+code);that.runjs(path,name,code)})}else if(/\.css?.+$/.test(path)){this.iocss(path,name,function(code){document.getElementById(name).appendChild(document.createTextNode(code));that.setLS(name,path+versionString+code)},cssonload)}};lsloader.iojs=function(path,jsname,callback){var that=this;that.jsRunSequence.push({name:jsname,code:""});try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(path,jsname,xhr.response);return}}that.jsfallback(path,jsname)}};xhr.send(null)}catch(e){that.jsfallback(path,jsname)}};lsloader.iocss=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.iofonts=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.runjs=function(path,name,code){if(!!name&&!!code){for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code=code}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var script=document.createElement("script");script.appendChild(document.createTextNode(this.jsRunSequence[0].code));script.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(script);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var that=this;var script=document.createElement("script");script.src=this.jsRunSequence[0].path;script.type="text/javascript";this.jsRunSequence[0].status="loading";script.onload=function(){that.jsRunSequence.shift();if(that.jsRunSequence.length>0){that.runjs()}};document.body.appendChild(script)}};lsloader.tagLoad=function(path,name){this.jsRunSequence.push({name:name,code:"",path:path,status:"failed"});this.runjs()};lsloader.jsfallback=function(path,name){if(!!this.jsnamemap[name]){return}else{this.jsnamemap[name]=name}for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code="";this.jsRunSequence[k].status="failed";this.jsRunSequence[k].path=path}}this.runjs()};lsloader.cssfallback=function(path,name,cssonload){if(!!this.cssnamemap[name]){return}else{this.cssnamemap[name]=1}var link=document.createElement("link");link.type="text/css";link.href=path;link.rel="stylesheet";link.onload=link.onerror=cssonload;var root=document.getElementsByTagName("script")[0];root.parentNode.insertBefore(link,root)};lsloader.runInlineScript=function(scriptId,codeId){var code=document.getElementById(codeId).innerText;this.jsRunSequence.push({name:scriptId,code:code});this.runjs()};lsloader.loadCombo=function(jslist){var updateList="";var requestingModules={};for(var k in jslist){var LS=this.getLS(jslist[k].name);if(!!LS){var version=LS.split(versionString)[0];var code=LS.split(versionString)[1]}else{var version=""}if(version==jslist[k].path){this.jsRunSequence.push({name:jslist[k].name,code:code,path:jslist[k].path})}else{this.jsRunSequence.push({name:jslist[k].name,code:null,path:jslist[k].path,status:"comboloading"});requestingModules[jslist[k].name]=true;updateList+=(updateList==""?"":";")+jslist[k].path}}var that=this;if(!!updateList){var xhr=new XMLHttpRequest;xhr.open("get",combo+updateList,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){that.runCombo(xhr.response,requestingModules);return}}else{for(var i in that.jsRunSequence){if(requestingModules[that.jsRunSequence[i].name]){that.jsRunSequence[i].status="failed"}}that.runjs()}}};xhr.send(null)}this.runjs()};lsloader.runCombo=function(comboCode,requestingModules){comboCode=comboCode.split("/*combojs*/");comboCode.shift();for(var k in this.jsRunSequence){if(!!requestingModules[this.jsRunSequence[k].name]&&!!comboCode[0]){this.jsRunSequence[k].status="comboJS";this.jsRunSequence[k].code=comboCode[0];this.setLS(this.jsRunSequence[k].name,this.jsRunSequence[k].path+versionString+comboCode[0]);comboCode.shift()}}this.runjs()}})();</script>

    <!-- Import CSS & jQuery -->
    
        <style id="css/material.min.css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("css/material.min.css","/css/material.min.css?fJTiM/K1J3dWIruo3pxtAw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";})</script>
        <style id="css/style.min.css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("css/style.min.css","/css/style.min.css?oCSEO3ST+aEypEwttTDI9g==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";})</script>
        
        
            <style>
    
    .footer-sns-facebook {
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgY2xhc3M9Imljb24iIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0xMzguNiA3OGMtMjIuNCA1LjItNTUuOCA0MC4yLTYwLjYgNjMuNC0xLjQgNi40LTIgMTI5LjgtMS42IDM2Ny42LjYgMjk4LjYgMSAzNTguOCAzLjQgMzYzIDExIDIwLjIgMjEuNiAzMi40IDM3LjIgNDMgMTUgMTAuMiAxNy40IDExLjIgMzMgMTMgMTEuMiAxLjQgMTM2IDIgMzY1IDEuNiAzMTQtLjYgMzQ4LjYtMSAzNTUtMy44IDE1LjgtNy4yIDMzLjgtMjIgNDMuMi0zNS40IDUuMi03LjQgMTAuOC0xNi42IDEyLjYtMjAuNCAyLjgtNi40IDMuMi00MC44IDMuOC0zNTQgLjQtMjIzLS4yLTM1My40LTEuNC0zNjUtMi0xNy0yLjYtMTguNi0xMy0zNC04LjYtMTIuNi0xNC4yLTE4LjQtMjUuMi0yNS44LTcuOC01LjQtMTcuNC0xMS0yMS42LTEyLjQtNi0yLjItNzIuOC0yLjYtMzY1LjQtMi42LTE5Ni44LjItMzYxIC44LTM2NC40IDEuOHptNjU3LjYgODcuOGw0LjggMy44djU1LjJjMCA1NC42IDAgNTUuMi00LjYgNTkuNi00LjQgNC40LTYgNC42LTUwLjIgNS42bC00NS42IDEtNy4yIDUuNmMtMTAuNCA4LTE2LjggMTcuMi0xOS4yIDI3LjQtMSA1LTEuOCAyNC44LTEuOCA0NCAuMiAzOCAxLjYgNDQuNiAxMC44IDQ4IDIuOCAxLjIgMjguNCAyIDU2LjggMiA0Ny44IDAgNTIgLjIgNTYuMiAzLjhsNC44IDMuOHY1NS4yYzAgNTQuNiAwIDU1LjItNC42IDU5LjYtNC40IDQuNi01LjQgNC42LTU3IDUuMi0yOC44LjItNTQuNC44LTU2LjggMS40LTIuNC42LTUuNiAzLTYuOCA1LjQtMS44IDMuMi0yLjQgNDEuNC0yLjYgMTQzLjJsLS4yIDEzOC44LTUuNiA0LjgtNS42IDQuOEg2MDljLTUyLjQgMC01Mi44IDAtNTguMi00LjZsLTUuNC00LjYtLjItMTQwLjYtLjItMTQwLjYtNC44LTMuOGMtNC4yLTMuNC04LTMuOC0zNS42LTMuOC0zMi44IDAtNDEtMS44LTQzLjYtMTAtLjYtMi4yLTEuMi0yNS40LTEuMi01MS40IDAtNjAuOC0uMi01NyAzLjQtNjEuNiAyLjgtMy42IDYtNCAzNy44LTUgMzMtMSAzNS4yLTEuMiAzOS40LTUuNiA0LjYtNC40IDQuNi01LjIgNS44LTcxIDEuMi03My40LjItNjcuMiAxNi42LTk5LjQgOC0xNS44IDEyLjgtMjIgMjgtMzcgMTUuMi0xNS4yIDIxLjQtMTkuNiAzOC4yLTI4IDExLTUuNCAyNC0xMSAyOS0xMi4yIDYuMi0xLjggMjguNi0yLjYgNzEuMi0yLjYgNTguNi0uMiA2Mi42IDAgNjcgMy42eiIvPjwvc3ZnPg==);
    }
    
    
    .footer-sns-twitter {
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgY2xhc3M9Imljb24iIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0xMzguNiA3OGMtMjIuNCA1LjItNTUuOCA0MC4yLTYwLjYgNjMuNC0xLjQgNi40LTIgMTI5LjgtMS42IDM2Ny42LjYgMjk4LjYgMSAzNTguOCAzLjQgMzYzIDExIDIwLjIgMjEuNiAzMi40IDM3LjIgNDMgMTUgMTAuMiAxNy40IDExLjIgMzMgMTMgMTEuMiAxLjQgMTM2IDIgMzY1IDEuNiAzMTQtLjYgMzQ4LjYtMSAzNTUtMy44IDE1LjgtNy4yIDMzLjgtMjIgNDMuMi0zNS40IDUuMi03LjQgMTAuOC0xNi42IDEyLjYtMjAuNCAyLjgtNi40IDMuMi00MC44IDMuOC0zNTQgLjQtMjIzLS4yLTM1My40LTEuNC0zNjUtMi0xNy0yLjYtMTguNi0xMy0zNC04LjYtMTIuNi0xNC4yLTE4LjQtMjUuMi0yNS44LTcuOC01LjQtMTcuNC0xMS0yMS42LTEyLjQtNi0yLjItNzIuOC0yLjYtMzY1LjQtMi42LTE5Ni44LjItMzYxIC44LTM2NC40IDEuOHptNTMyLjggMjA1YzEwIDQgMjMgMTAuOCAyOC44IDE1LjIgMTIuNiA5LjIgMTYuNiAxMC42IDI5LjQgOS40IDYuNi0uNiAxMy0zLjIgMjAuNC04LjIgMTEuMi03LjYgMTkuNC05LjIgMjMuNi01IDMuNiAzLjYgMi44IDktMi44IDE4LjYtNy4yIDEyLjQtNiAxOC44IDQuMiAyNC4yIDQuNCAyLjIgOC4yIDUuNiA4LjYgNy40IDEgNC44LTEyLjYgMjQuMi0yMiAzMS44LTExLjggOS4yLTE3LjIgMjIuNi0xOS42IDQ3LjgtNC44IDUwLjQtNy44IDY2LjYtMTYuNCA4NS40LTMgNy03IDE3LjgtOC44IDI0LTEuOCA2LjQtNSAxNC42LTcuNCAxOC40LTIuMiAzLjgtNy40IDEzLTExLjQgMjAuNC0xNy4yIDMwLjgtNDMuNCA2MS40LTcxLjQgODMuOC0yNS42IDIwLjQtNDYgMzMuMi02NC4yIDQwLjItOC40IDMuMi0xOCA3LjYtMjEuNCA5LjYtNy40IDQuNi0yMi40IDguNi01Ny4yIDE1LTYyLjIgMTEuNi03OS4yIDExLjQtMTM1LjYtMS0zMi40LTctMzguNi05LTUyLTE2LjgtMjEuNC0xMi42LTI0LjItMTQuOC0yNC4yLTE5LjQgMC02LjIgMTAuMi05LjIgMzUtMTAuNCAyMi40LTEgMjguNi0yLjYgNTctMTQuMiAyMy44LTkuOCAyOS40LTEyLjggMzAuNC0xNi44IDIuMi04LjItMy0xMy4yLTI2LjgtMjUuNC0yNS44LTEzLjItMzIuMi0xOC40LTQzLjgtMzUuOC05LTEzLjYtMTAtMjEuMi0zLjYtMzMuNiA1LjQtMTAuOCAzLjYtMTUtMTEuOC0yNS40LTktNi0xNC0xMS42LTIwLjgtMjIuNi0yMy40LTM3LjgtMjUtNTAuOC03LjItNTkuOCA0LjgtMi40IDkuNC01LjQgMTAuMi02LjYgMi44LTQuMi0uNC0xNS42LTguNC0yOS0xMS42LTE5LjYtMTMuMi0yNS44LTEzLjItNTUuMiAwLTI4LjggMi42LTM3LjggMTItNDAuMiA5LTIuMiAxNC44IDEgMzUuNiAyMC4yIDI0LjggMjIuOCA0My42IDM2LjYgNjIuOCA0NS44IDggMy44IDE3LjggOS4yIDIyIDEyIDQuMiAyLjggMTQuOCA3IDIzLjQgOS4yIDguNiAyLjIgMjQuMiA2LjggMzQuOCAxMC4yIDEzLjQgNC40IDIzLjYgNi40IDMzIDYuNiAxMi44LjIgMTQuMi0uMiAxOC42LTUuNCA0LTQuOCA0LjgtNy44IDQuOC0xOS4yIDAtMTQuNCA1LjYtMzkuNiAxMS4yLTUwLjYgNC4yLTguNCAyOS4yLTM0LjIgMzkuOC00MS40IDcuOC01LjQgMzUuNi0xNiA1Mi0yMCAxNC4yLTMuNiAzMi42LTEuMiA1Mi40IDYuOHoiLz48L3N2Zz4=);
    }
    
    
    .footer-sns-gplus {
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgY2xhc3M9Imljb24iIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0xMzguNiA3OGMtMjIuNCA1LjItNTUuOCA0MC4yLTYwLjYgNjMuNC0xLjQgNi40LTIgMTI5LjgtMS42IDM2Ny42LjYgMjk4LjYgMSAzNTguOCAzLjQgMzYzIDExIDIwLjIgMjEuNiAzMi40IDM3LjIgNDMgMTUgMTAuMiAxNy40IDExLjIgMzMgMTMgMTEuMiAxLjQgMTM2IDIgMzY1IDEuNiAzMTQtLjYgMzQ4LjYtMSAzNTUtMy44IDE1LjgtNy4yIDMzLjgtMjIgNDMuMi0zNS40IDUuMi03LjQgMTAuOC0xNi42IDEyLjYtMjAuNCAyLjgtNi40IDMuMi00MC44IDMuOC0zNTQgLjQtMjIzLS4yLTM1My40LTEuNC0zNjUtMi0xNy0yLjYtMTguNi0xMy0zNC04LjYtMTIuNi0xNC4yLTE4LjQtMjUuMi0yNS44LTcuOC01LjQtMTcuNC0xMS0yMS42LTEyLjQtNi0yLjItNzIuOC0yLjYtMzY1LjQtMi42LTE5Ni44LjItMzYxIC44LTM2NC40IDEuOHpNNDMwIDI5NS40YzQwLjYgMTUuNCA1Ni42IDIzLjggNzIuNiAzOC40IDYuOCA2LjIgNy4yIDE1LjIgMSAyMy40LTYuMiA4LTMzLjYgMzMuOC0zOSAzNi42LTUuNiAyLjgtMTcuNiAyLjgtMjMuMi0uMi0yLjQtMS4yLTguMi01LjItMTMtOC44LTExLjItOC42LTI0LjYtMTEuMi01NS4yLTExLjItMjcuNCAwLTQwLjYgMi42LTUyLjIgMTAuNC00LjQgMi44LTEyLjIgNy42LTE3LjIgMTAuNi0yMyAxMy4yLTUxLjQgNTUtNTUuOCA4Mi40LTIuNiAxNS42LTIuNCAzNC44LjIgNTEgMi44IDE3LjQgMTkuOCA0OC44IDM1LjIgNjUuMiAxNiAxNi42IDQ1IDMzLjYgNjIuOCAzNi42IDI2LjggNC40IDY1LjggMS42IDc5LjQtNS44IDIwLjYtMTEuNCAzMS0xOSA0MS0zMC40IDE4LjgtMjEuNiAyMy40LTM0LjIgMTUuNi00My44LTMuOC00LjgtNC40LTQuOC01MS01LjgtNjAuOC0xLjItNTYuMiAyLjItNTYuMi00My4yIDAtMzIuNC4yLTMzLjIgNC44LTM3IDQuNC0zLjYgOS0zLjggOTItMy44IDc5IDAgODcuOC40IDk0LjIgMy42IDExLjIgNS42IDEzIDExLjQgMTIuOCA0My40IDAgMjUuNC0uOCAzMC44LTcuNiA1OC00IDE2LjYtOS44IDM0LTEyLjYgMzktMi44IDUtOC4yIDE0LjItMTEuNiAyMC42LTguNCAxNS40LTI3LjIgMzYuOC00MC44IDQ2LjYtNS44IDQuNC0xMy44IDEwLjItMTcuNiAxMy4yLTMuOCAzLTExIDctMTYuMiA4LjgtNS4yIDEuOC0xNi4yIDYuNC0yNC40IDEwLTIyLjQgOS42LTM0LjggMTEuNi03MyAxMS42LTM3LjYuMi00Ny0xLjQtNzEtMTItOC4yLTMuNi0xNy42LTcuMi0yMC44LTgtMTUuOC0zLjgtNjctNDUuMi03Ny44LTYyLjgtMi4yLTMuOC03LjYtMTEuNi0xMS44LTE3LjItNC4yLTUuNC05LTE0LTEwLjYtMTktMS44LTQuOC02LjItMTYtMTAtMjQuOC0zLjYtOC44LTcuOC0yMi4yLTkuMi0yOS42LTMuMi0xOC44LTEuNC03OS40IDIuOC05MS40IDEzLjgtNDAuNiAzNS42LTc4IDU4LjgtMTAwLjIgMTQtMTMuNiA0Ny4yLTM2LjQgNTgtMzkuOCA0LjItMS40IDEzLjQtNS4yIDIwLjYtOC40IDIyLTEwIDMyLjgtMTEuNiA3Ni0xMSAzMy44LjYgNDAuNCAxLjIgNTAgNC44em0zNDAuOCA4MC44YzggMy42IDkuNiAxMS4yIDkuMiAzOS4yLS42IDM0LjQtLjYgMzQgNSAzOS42IDQuOCA1IDUuNCA1IDM3LjYgNSA0My40IDAgNDQuNC44IDQzLjIgMzYuMi0uOCAxNy0xLjIgMTguNC02LjQgMjMtNS40IDQuNi02LjYgNC44LTM3LjYgNC44LTMxLjIgMC0zMiAuMi0zNi44IDUtNS42IDUuNC01LjYgNC40LTUgNDEuMi40IDI2LjQuMiAyNy40LTQuNiAzMy00LjggNS42LTYgNS44LTI0LjQgNi40LTIwLjguOC0yOS42LTEuNC0zMy40LTguNC0xLjQtMi42LTItMTUuNi0xLjgtMzUuNi40LTMxLjIuNC0zMS42LTQuNi0zNi42cy01LjYtNS0zNi01Yy0xOC44IDAtMzMtLjgtMzYtMi4yLTcuNi0zLjYtOS42LTExLjItOC44LTMzLjguOC0yOC4yLjQtMjggNDEtMjggNDUuNCAwIDQ1LjQgMCA0NC42LTQyLjYtLjYtMzMtLjYtMzMgNS0zOC40IDQuNC00LjYgNi4yLTUgMjQuOC01IDExIDAgMjIuMiAxIDI1IDIuMnoiLz48L3N2Zz4=);
    }
    
    
    
    
    
    
    
    
    
</style>

        
        <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"rel="stylesheet">


        <script>lsloader.load("js/jquery.min.js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==")</script>
    
    
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Analytics -->
    

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    
    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#概述"><span class="post-toc-number">1.</span> <span class="post-toc-text">概述</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#报文结构"><span class="post-toc-number">2.</span> <span class="post-toc-text">报文结构</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#连接管理"><span class="post-toc-number">3.</span> <span class="post-toc-text">连接管理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#连接打开"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">连接打开</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#序列号"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">序列号</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#连接关闭"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">连接关闭</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#连接半关闭"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">连接半关闭</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#同时打开与关闭"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">同时打开与关闭</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#状态转换"><span class="post-toc-number">3.6.</span> <span class="post-toc-text">状态转换</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#TCP选项"><span class="post-toc-number">4.</span> <span class="post-toc-text">TCP选项</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#超时重传"><span class="post-toc-number">5.</span> <span class="post-toc-text">超时重传</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#快速重传"><span class="post-toc-number">6.</span> <span class="post-toc-text">快速重传</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#窗口管理"><span class="post-toc-number">7.</span> <span class="post-toc-text">窗口管理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#nagle算法"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">nagle算法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#延迟确认"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">延迟确认</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#滑动窗口"><span class="post-toc-number">7.3.</span> <span class="post-toc-text">滑动窗口</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#拥塞控制"><span class="post-toc-number">7.4.</span> <span class="post-toc-text">拥塞控制</span></a></li></ol></li></ol>
        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>
    





<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                计算机网络系列 7 - TCP
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Albert Humbert</strong>
        <span>11月 09, 2018</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/notes/">notes</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=计算机网络系列 7 - TCP&url=https://alberthumbert.github.io/2018/11/09/NetTcp/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=计算机网络系列 7 - TCP&url=https://alberthumbert.github.io/2018/11/09/NetTcp/index.html&via=Albert Humbert" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=https://alberthumbert.github.io/2018/11/09/NetTcp/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=https://alberthumbert.github.io/2018/11/09/NetTcp/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    
        <a class="post_share-link" href="https://www.linkedin.com/shareArticle?mini=true&url=https://alberthumbert.github.io/2018/11/09/NetTcp/index.html&title=计算机网络系列 7 - TCP" target="_blank">
            <li class="mdl-menu__item">
                分享到 LinkedIn
            </li>
        </a>
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=Albert&#39;s Blog&title=计算机网络系列 7 - TCP&summary=developing&pics=https://alberthumbert.github.io/img/favicon.png&url=https://alberthumbert.github.io/2018/11/09/NetTcp/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
        <a class="post_share-link" href="https://telegram.me/share/url?url=https://alberthumbert.github.io/2018/11/09/NetTcp/index.html&text=计算机网络系列 7 - TCP" target="_blank">
            <li class="mdl-menu__item">
                分享到 Telegram
            </li>
        </a>
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>-</p>
<a id="more"></a>
<p><br></p>
<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p><strong>TCP提供一种面向连接的、可靠的字节流服务，包含如下组成要输</strong></p>
<ul>
<li>字节流服务，指数据在应用层看来是没有消息边界的，发送端可以多次写入不同大小的数据，接受方也可以多次读入不同大小的数据，读写次数及读写量不需要一致。tcp不会解读字节流里的内容，但它需要把字节流打散为ip可以携带的分组(也就是我们说的包)，每个分组对应一个序列号，该序列号是数据在整个字节流的偏移量</li>
</ul>
<ul>
<li>校验和，tcp包含一个强制校验和来检测比特差错，与udp一样使用端到端的伪首部和函数来计算，被检出差错的包会被丢弃，不发生确认</li>
</ul>
<ul>
<li>确认(ack) ，tcp会发送一个确认来表示收到了正确的数据，一般而言这个确认不是接受到报文段就立即发送的，因为tcp使用的ack字段是累加的，它代表共接收到多少字节，这样的设计可以减少发送报文的时间，并且使一个ack丢失时，后续的ack可以用来确认前面的报文段</li>
</ul>
<ul>
<li>超时重传，tcp为每个滑动窗口设置一个重传计时器，在ack到达时更新，如果有一个确认没有被按时收到，那么报文段就会被重传</li>
</ul>
<ul>
<li>全双工，数据可以向两个方向流动，两个方向相互独立，因此tcp需要为每个方向的数据都建立序列号。一个方向的报文段也用来承载相反方向数据的ack，同样是为了减少发送报文的时间</li>
</ul>
<p><br></p>
<h3 id="报文结构"><a href="#报文结构" class="headerlink" title="报文结构"></a>报文结构</h3><p><img src="http://wx3.sinaimg.cn/mw690/007vHOvngy1fzkf0tfh8yj30r60f674s.jpg" alt=""></p>
<ul>
<li>端口号，作用与udp一致，tcp使四元组来对应一个socket</li>
</ul>
<ul>
<li>序列号，标识了报文段中第一个字节在流中的偏移量，为32位无符号数，到达2^32-1后循环为0</li>
</ul>
<ul>
<li>确认号，确认号实际上是期待接收的下一个序号，在ACK字段启用时才有效，通常在初始和结束以外的报文段中都有效，</li>
</ul>
<ul>
<li>头部号，TCP头部通常是20字节长，带选项的话则可达60字节，因此头部长度是可变的</li>
</ul>
<ul>
<li>窗口大小，用于tcp流量控制，这个窗口大小是字节数，窗口由ACK号指定的字节开始</li>
</ul>
<ul>
<li>ACK，确认（确认号字段有效，建立连接后一般都启用），ACK不消耗序列号，不支持重传</li>
</ul>
<ul>
<li>SYN，用于初始化一个连接的同步序号，建立一个新连接时，客户机向服务器发送的第一个报文段的SYN位字段被启用，序列号字段则为一个随机的初始序列号(ISN，随机是一种安全措施)，随后该方向的所有序列号的确然号都建立在这个ISN上面。SYN，FIN，以及应用字节都会消耗一个序列号(即数据的第一个字节序列号为ISN+1)，这意味着它们都支持重传</li>
</ul>
<ul>
<li>CWR，拥塞窗口减（发送方降低发送速率）</li>
</ul>
<ul>
<li>ECE，ECN回显（发送方接受到了一个更早的拥塞通告）</li>
</ul>
<ul>
<li>URG，紧急（紧急指针字段有效，很少用）</li>
</ul>
<ul>
<li>PSH，推送（接收方尽快给应用程序传送这个数据，没有被可靠的实现或使用）</li>
</ul>
<ul>
<li>RST，重置连接（连接取消，回到listen，经常是因为错误）</li>
</ul>
<ul>
<li>FIN，发送方已经结束向对方发送数据</li>
</ul>
<ul>
<li>校验和，校验和覆盖了tcp头部和数据以及首部中的一些字段，是强制的，由发送方计算，接收方验证，使用的算法和ip，udp，icmp相同</li>
</ul>
<ul>
<li>紧急指针，在URG字段启用时才有效，它是一个偏移量，加载序列号字段上面标识紧急数据的最后一个字节，作用是告诉接收方尽快接受这些数据</li>
</ul>
<ul>
<li>选项字段，最常见的是最大段大小(MSS)，一般在每个端点发送的第一个报文段上指定，表示希望收到的报文段的最大值</li>
</ul>
<ul>
<li>数据部分，数据部分本身也是可选的，连接建立，终止，确认时都有可能发送不带任何数据吧报文段</li>
</ul>
<p><br></p>
<h3 id="连接管理"><a href="#连接管理" class="headerlink" title="连接管理"></a>连接管理</h3><p><strong>从这里开始才是tcp机制的重点</strong></p>
<ul>
<li>一个tcp连接的标识由一个四元组构成，包括两个ip地址和两个端口号，每个连接对应一对端点(或套接字)，当四元组完全重复时，端系统将禁止建立链接并返回一个错误</li>
</ul>
<ul>
<li>一个tcp连接分为3个阶段：启动、传输、退出</li>
</ul>
<p><img src="http://wx2.sinaimg.cn/mw690/007vHOvngy1fztan4y7ucj30fs0i5jsk.jpg" alt=""></p>
<p><br></p>
<h4 id="连接打开"><a href="#连接打开" class="headerlink" title="连接打开"></a>连接打开</h4><ul>
<li>建立连接需要完成以下步骤，一共包括三个报文段，因此也称为三次握手，这里将连接的主动建立方称为客户端，被动建立方称为服务器，这种方式属于常见的情况，还有一种服务器和客户端同时建立连接的情况</li>
</ul>
<ol>
<li>客户端发送syn报文段，该报文段syn位置位，包含需要连接的端口号，seq数值为初始序列号isn，</li>
<li>服务器发送syn + ack报文段，该报文段syn位和ack位置位，ack数值为isn + 1 ，seq数值为另一isn，因此syn报文段如果丢失，客户端也可以知道需要重传，该报文段表示服务器收到了请求</li>
<li>客户端发送ack报文段，该报文段 ack 位置位，ack数值和seq数值为 各自方向上的isn +1，该报文段表示客户端收到了服务器的回应</li>
</ol>
<p><br></p>
<h4 id="序列号"><a href="#序列号" class="headerlink" title="序列号"></a>序列号</h4><ul>
<li>序列号用于解决报文接受顺序混乱的问题，在发送syn报文之前，都双方需要确定一个初始序列号</li>
</ul>
<ul>
<li><p>初始序列号需要设计得难以预测，因为当攻击者使用伪装成用户，使用用户的ip时，如果可以推测出初始序列号，那么即使攻击者实际上收不到syn+ack报文段，也可以通过初始序列号发送正确的ack报文建立连接，并且发送数据</p>
</li>
<li><p>一般初始序列号的随机机制建立在时钟之上，Linux上为对每个连接为时钟设置由散列函数得出的偏移量</p>
</li>
</ul>
<p><br></p>
<h4 id="连接关闭"><a href="#连接关闭" class="headerlink" title="连接关闭"></a>连接关闭</h4><ul>
<li>关闭连接需要完成以下步骤，一共包括四个报文段，因此也称为四次挥手，通常来说关闭连接的发起方也是客户端，不过web服务器在作出相应之后也可能发起一个关闭操作</li>
</ul>
<ol>
<li>主动关闭方发送fin + ack报文段，ack数值和seq数值取决于前面数据传输的情况，这里假设分别为L和K</li>
<li>被动关闭方发送ack报文段，ack数值为K+1，seq数值为L，表示已经接受到了关闭请求</li>
<li>被动关闭方发送fin + ack报文段，ack数值为L，seq数值为K+1，表示被动方也决定关闭相反方向的连接</li>
<li>主动关闭方发送ACK报文段，ack数值为L+1，seq数值为K，同样表示收到了对方的关闭请求，注意上述的两个fin报文段，如果没有收到响应的ack报文段，则就会重新传输</li>
</ol>
<p><br></p>
<h4 id="连接半关闭"><a href="#连接半关闭" class="headerlink" title="连接半关闭"></a>连接半关闭</h4><ul>
<li>值得注意的是上述的两个fin报文段，代表各自方向的关闭请求，如果没有收到响应的ack报文段，则就会重新发送fin报文段，但并不是两个传输方向都必须发送关闭请求，可以选择仅仅关闭传输的其中一个方向，这种状况被称为半关闭，对于关闭哪个方向，协议上也不做限制</li>
</ul>
<pre><code>int shutdown(int sockfd,int how);

SHUT\_RD（0）：关闭sockfd上的读功能，此选项将不允许sockfd进行读操作。不允许接受

SHUT\_WR（1）：关闭sockfd的写功能，此选项将不允许sockfd进行写操作。不允许发送

SHUT\_RDWR（2）：关闭sockfd的读写功能。不允许发送和接受(和 close() 一样)

int close(int fd);

关闭读写，它将防止套接字上更多的数据的读写
任何在另一端读写套接字的企图都将返回错误
</code></pre><ul>
<li>socket中半关闭的api对应的是shutdown(fd,1), 在操作系统的支持下shutdown本质上接受两个连接上的控制，普通关闭的方式为close(fd)，它的效果和 shutdown(fd,2) 一样，连接半关闭需要两个报文段，两个方向上的半关闭就相当于普通的关闭，只是在它们之间仍允许一个方向发送数据，注意某个方向的连接半关闭时，依然会发送ack报文段进行确认，只是该报文段不再携带数据</li>
</ul>
<ol>
<li>主动关闭方发送fin + ack报文段，ack数值和seq数值取决于前面数据传输的情况，这里假设分别为L和K</li>
<li>被动关闭方发送ack报文段，ack数值为K+1，seq数值为L，表示已经接受到了关闭请求</li>
<li>被动关闭放仍可以发送数据报文段，但主动关闭方只能发送ack报文段</li>
</ol>
<p><img src="http://wx1.sinaimg.cn/mw690/007vHOvngy1fztav6f70hj30fs0fkmxw.jpg" alt=""></p>
<p><br></p>
<h4 id="同时打开与关闭"><a href="#同时打开与关闭" class="headerlink" title="同时打开与关闭"></a>同时打开与关闭</h4><ul>
<li>这种情况下双方必须都知道对方用于通信的ip和端口号，同时打开与关闭都需要四个报文段，并且报文段的发送接受一般是交叉进行的</li>
</ul>
<ul>
<li>同时关闭连接和正常关闭连接基本没有区别，但同时开启连接时双方都需要发送一个syn和一个syn+ack报文段，用于发送请求和确认请求</li>
</ul>
<p><br></p>
<h4 id="状态转换"><a href="#状态转换" class="headerlink" title="状态转换"></a>状态转换</h4><ul>
<li>tcp的11个状态转换情况如下，这11个状态名称来自*nix和win上面的nestat命令的输出名称，下面只讲解一些比较重要的点</li>
</ul>
<p><img src="http://wx1.sinaimg.cn/mw690/987832a0gy1g00itnztknj20oi0jm0vi.jpg" alt=""></p>
<ul>
<li>SYN_RCVD返回LISTEN状态只有在SYN_RCVD是在LISTEN状态转换来的才是正确的，它的作用是让SYN_RCVD状态中的客户端接受到重置报文后返回LISTEN状态等待另一个连接请求</li>
</ul>
<ul>
<li>TIME_WAIT状态，也称为2MSL状态，首先调用close()发起主动关闭的一方，在发送最后一个ack之后会进入time_wait的状态，保持2MSL时间(最大段生存期)之后才会正式关闭连接，需要TIME_WAIT的原因有两个，一个是为实现连接的可靠释放，因为最后一个ack可能丢失，这时被动关闭方会超时重发fin报文段同时使这个ack能重新发送，第二个原因是使旧的数据包在网络因过期而消失，这时为了避免之后使用相同四元组时建立的新连接接受到上一次连接的旧数据。在高并发的业务场景下可能会出现产生了大量TIME_WAIT的socket的问题，服务器可以使用SO_REUSEADDR来重用TIME_WAIT状态下的端口，或者更加合理的设置2MSL时间</li>
</ul>
<ul>
<li>CLOSE_WAIT状态，当被动关闭方接受到FIN报文段时，在端系统未调用close之前都处于这种情况，正常情况下一般是还有数据没发送完，或者还没到关闭的时机，非正常情况则是程序员遗漏了close操作(多进程需要特别注意close，因为不同与shutdown，close受socket引用计数的影响)，这时往往会导致大量处于该状态的socket，最好是排查程序，另外还可以设置超时</li>
</ul>
<ul>
<li>FIN_WAIT2状态，当主动关闭方发送完FIN报文段后，如果接受到的不是fin+ack，而是ack报文段时会进入该状态，因为还需要一个fin报文段才可以关闭连接，正常情况是在使用半关闭通信，KeepAlive ，或者发送方还没有发送完数据，非正常情况下则是客户端设计不合理，也可以使用超时来解决，这个超时不是协议规定的，但大部分系统都有实现，<a href="https://www.2cto.com/shouce/ApacheManual/misc/fin_wait_2.html" target="_blank" rel="external">详见</a></li>
</ul>
<ul>
<li>RST报文段，tcp首部的rst位置位时即为重置报文段(socket上为SO_LINGER字段)，一般来说都是连接不正确导致的，比如对没有被监听的端口发送了连接请求，一般是客户端设错了本地端口，upd的情况是会导致一个不可达的icmp报文段，tcp则是使用rst报文段来完成相同的工作。RST可以用来强制释放一个连接，因为fin报文段需要在排队数据都发送完后才会被发送，但rst则会抛弃所有排队数据，fin被称为有序释放，rst被称为终止释放，终止释放有时被用于通信一端以外断开导致的半连接状态，当该段重启并再次连接时需要用RST回应旧连接的报文段，表示它对这些数据一无所知。rst对部分处在time_wait状态的接受端也适用，这时候将产生一个时间等待错误TWA，直接关闭连接，有些端系统在time_wait时不对RST做出任何反应</li>
</ul>
<p><br></p>
<h3 id="TCP选项"><a href="#TCP选项" class="headerlink" title="TCP选项"></a>TCP选项</h3><ul>
<li>tcp选项是由IANA维护的，每一个选项的头一个字节为种类，部分类型的选项长度是固定的，另外则是可变的，常见的tcp选项如下</li>
</ul>
<ol>
<li>最大段大小MSS，允许对方发送的最大报文段，只记录数据字段，不包括tcp与ip头部，建立连接时每一方都需要使用该选项来说明允许的大小，否则默认为536字节，因为任何主机都只是需要能处理576字节(需要去掉最小头部)</li>
<li>选择确认SACK，由于窗口滑动机制容易产生空洞，于是使用选择确认机制来通知发送方已接收到的数据块序列范围(SACK块)，SACK选项可以携带多个SACK块</li>
<li>窗口放大WSCALE，用来将tcp窗口大小从16位扩展到32位</li>
<li>时间戳TSPOT，用来发送2个4字节的时间戳，接收方可以利用这些时间戳计算往返时间，计算往返时间主要用于设置超时重传时间</li>
<li>用户超时UTO，用来指明发送者在确认对方收到数据之前愿意等待ACK确认的时间</li>
</ol>
<p><br></p>
<h3 id="超时重传"><a href="#超时重传" class="headerlink" title="超时重传"></a>超时重传</h3><ul>
<li>tcp采用基于计时器的重传策略，每次重传使用二进制指数退避，即等待重传的时间为上一次间隔的一倍，我们把一个间隔称为RTO，RTO需要通过RTT来确定，tcp还使用两个阈值来决定是否继续重传同一个报文段，R1为重传次数，至少为3次，R2为所用时间，至少为100秒</li>
</ul>
<ul>
<li>RTT：RTO不能大于RTT，避免数据报还未到达就重发，RTT的确定需要采集RTT样本，通常可以使用发送报文段和收到确认报文的时间间隔，并采用一定的算法得出比较合理的统计数值，这里不深入研究。每一个连接的rtt都独立估算，并且重传时钟会会对任何占用序列号的在传数据计时</li>
</ul>
<ul>
<li>计时：一旦得到了估计的RTT，就可以设置RTO了，在记录报文段的序列号之后，tcp为报文段设置一个定时器，当收到该报文的ack，则将这个定时器取消，每一个新的数据报都需要一个新的计时器</li>
</ul>
<ul>
<li>超时：若在一个RTO之内没有收到ack，那么就触发超时重传，超时重传还会导致tcp降低发送速率，一种方法是基于拥塞控制减小发送窗口的大小，另一种方法是增大RTO，即二进制指数退避</li>
</ul>
<p><br></p>
<h3 id="快速重传"><a href="#快速重传" class="headerlink" title="快速重传"></a>快速重传</h3><ul>
<li>接收方当收到失序的分组时，即收到序列号大于期待值的分组时，会发送冗余ack，当发送端接受到一定数量(dupthresh一般为3)的冗余ack就会引发快速重传，冗余ack通常也包括sack选项，用于表示有多少个空缺，导致失序分组的原因一般有两个，分组丢失或延迟到达，因为不能确定是哪一种情况，所以才需要设置dupthresh。快速重传也会触发拥塞控制机制</li>
</ul>
<p><br></p>
<h3 id="窗口管理"><a href="#窗口管理" class="headerlink" title="窗口管理"></a>窗口管理</h3><p><br></p>
<h4 id="nagle算法"><a href="#nagle算法" class="headerlink" title="nagle算法"></a>nagle算法</h4><ul>
<li>nagle算法是指任意时刻，最多只能有一个未被确认的小段，也就是小于MSS而且还没有收到ack的数据块，尽量搜集普通的小数据包合并成大的数据包，对于大于mss，或含有fin，或设置了TCP_NODELAY，或超时，或当前没有未确认小段时，数据包都是直接发送的</li>
</ul>
<pre><code>（1）如果包长度达到MSS，则允许发送；
（2）如果该包含有FIN，则允许发送；
（3）设置了TCP\_NODELAY选项，则允许发送；
（4）未设置TCP\_CORK选项时，若所有发出去的小数据包（包长度小于MSS）均被确认，则允许发送；
（5）上述条件都未满足，但发生了超时（一般为200ms），则立即发送。
</code></pre><ul>
<li>TCP_NODELAY本质是禁用nagle算法，TCP_CORK则是使用比nagle更加强制性的算法，它没有一个未被确认的小段的限制，会尽量的将数据包合并为一个MSS</li>
</ul>
<p><br></p>
<h4 id="延迟确认"><a href="#延迟确认" class="headerlink" title="延迟确认"></a>延迟确认</h4><ul>
<li>tcp一般不对每个数据包都返回ack，而是将ack和需要传输的数据结合发送，以减少数据包的数量</li>
</ul>
<ul>
<li>延迟确认在大数据包传输中大量使用，但在小数据包传输中和nagle等算法配合可能不太令人满意，因为服务端在等待客户端的延迟ack时可能由于nagle而不能发送更多数据包</li>
</ul>
<p><br></p>
<h4 id="滑动窗口"><a href="#滑动窗口" class="headerlink" title="滑动窗口"></a>滑动窗口</h4><ul>
<li>每个tcp都是双向连接，连接的收发数据是通过一组窗口结构维护的，每个连接的两端都都维护一个发送窗口和一个接受窗口，窗口以字节为管理单位，提供窗口的大小是由接受端的ack中的窗口大小字段控制的</li>
</ul>
<ul>
<li>提供窗口结构如下，窗口边界不能左移，因为ack号有累积性不能返回，当ack增大时窗口大小不变时为右滑，窗口也有可能减小，当大小为零时，称为零窗口</li>
</ul>
<p><img src="http://wx1.sinaimg.cn/mw690/987832a0gy1g01pdy84wyj20hn0bbt93.jpg" alt=""></p>
<ul>
<li>接受窗口结构如下，该窗口内的字节没有区分，只要序列号不再窗口范围当中，报文段都会被抛弃，使用sack选项时窗口范围内的任何序列号都可以接受确认，若不使用sack，则只有左边界的序列号可以接受确认，左边界的序列号被确认时会导致窗口右滑</li>
</ul>
<p><img src="http://wx2.sinaimg.cn/mw690/987832a0gy1g01q1n2ynvj20hn0aujrm.jpg" alt=""></p>
<ul>
<li>比较特殊的情况是零窗口，它可以有效阻止发送端继续发送数据，当接收端可以接受数据时需要发送一个窗口更新ack报文段，它通常不包含任何数据。为了避免该报文段丢失，发送端会使用一个持续计时器来间歇性的发送窗口探测报文段查询接收端，它包含一个字节的数据，因此避免丢失</li>
</ul>
<p><br></p>
<h4 id="拥塞控制"><a href="#拥塞控制" class="headerlink" title="拥塞控制"></a>拥塞控制</h4><ul>
<li>并没有一种精确的方法可以知晓中间路由器的状况，tcp最常用的拥塞检测方法基于丢包，其他方法包括时延测量和显示拥塞通知，当检测当拥塞，tcp需要有效减缓tcp的发送</li>
</ul>
<ul>
<li>tcp使用拥塞窗口cwnd来反应网络传输能力，它和接受端通知窗口awnd共同决定发送端窗口大小，不能大于两者中的较小值，由于cwnd不可能精确得到，因此一般使用慢启动来确定</li>
</ul>
<ul>
<li>慢启动：慢启动一般在连接建立或检测到超时重传时使用，发送端长时间空闲时也可能使用，慢启动用于在启用拥塞避免之前逐步获取cwnd值，以及帮助tcp建立ack时钟。慢启动的初始值一般为1个SMSS(发送方最大段大小)，每接受到新序列号的ack，会以min(接收方新接受的数据量,SMSS)来增加cwnd值，当cwnd增加时，可发送数据包数量也会增加，因此初始值为1时，正常情况下cwnd会以1 2 4 8 .. 增长，因此理想状态下cwnd会以指数增长</li>
</ul>
<ul>
<li>拥塞避免：为了避免慢启动中cwnd高速增长，tcp需要使用一种更加缓和的增长算法，它就是拥塞避免，公式如下，假设cwnd分k个包发送，数据接受完cwnd则增长了大约一个SMSS</li>
</ul>
<pre><code>cwnd=cwnd+SMSS\*SMSS/cwnd 
cwnd=cwnd+(1/k)\*SMSS
</code></pre><ul>
<li>ssthresh：慢启动什么时候进入拥塞避免由慢启动阈值ssthresh确定，当cwnd值大于ssthresh时使用拥塞避免机制，ssthresh不是固定的，它会记录上次最好的窗口估计值，一般是从拥塞避免来的，当发送超时重传时，会导致ssthresh降低为大约cwnd值的一半，cwnd重新设置为1，重新进入慢启动过程，发生快速重传时则会把ssthresh设置为cwnd的一半，把cwnd再设置为ssthresh的值，重新进入拥塞避免阶段</li>
</ul>
<ul>
<li>快速恢复：快速恢复建立在前面快速重传的情况下，TCP最后进入的不是拥塞避免阶段，而是快速恢复阶段，快速重传和快速恢复算法一般同时使用，但后者更加详细，也多一些步骤，快速恢复基于数据包守恒原则，只有当老数据包离开了网络后，才能向网络中发送一个新数据包，如果发送方收到一个重复的ack，那么就表明有一个数据包离开了网络</li>
</ul>
<pre><code>1.当收到3个重复ACK时，把ssthresh设置为cwnd的一半，把cwnd设置为ssthresh的值加3，然后重传丢失的报文段
加3的原因是因为收到3个重复的ACK，表明有3个“老”的数据包离开了网络。 

2.再收到重复的ACK时，拥塞窗口增加1。

3.当收到新的数据包的ACK时，把cwnd设置为第一步中的ssthresh的值。
原因是因为该不重复的好的ack表示失序问题已经解决
该恢复过程已经结束，可以回到恢复之前的状态了，也即再次进入拥塞避免状态
</code></pre><p><br><br><strong>本篇完</strong></p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2018/11/10/NetHttp/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2018/11/09/NetUdp/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.jpg);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="Albert Humbert's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        709913148@qq.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2019/04/">四月 2019<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/03/">三月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/01/">一月 2019<span class="sidebar_archives-count">16</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/12/">十二月 2018<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/11/">十一月 2018<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/10/">十月 2018<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/09/">九月 2018<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/05/">五月 2018<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">三月 2018<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">十二月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">十一月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">九月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">八月 2017<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">五月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">十一月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">十月 2016<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    
        <li>
            <a href="/about" title="关于我">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                关于我
            </a>
        </li>
        
    
        <li>
            <a href="/tags" title="标签索引">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                标签索引
            </a>
        </li>
        
    
        <li>
            <a href="/links" title="友情链接">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                友情链接
            </a>
        </li>
        
    
        <li>
            <a href="/whatever" title="Writers &amp; Weirdos">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                Writers &amp; Weirdos
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/twitter" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/facebook" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-facebook">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;2016&nbsp;-<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>Albert's Blog
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->


    <script>lsloader.load("js/lazyload.min.js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==")</script>
    <script>lsloader.load("js/js.min.js","/js/js.min.js?oAl/+lvaqTFV31JXTmbrNA==")</script>



    <script>lsloader.load("js/nprogress.js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==")</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Window Load-->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->

<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Bing Background -->


<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.4.0 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
